<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>テスト分析ツールwebR</title>
  <link rel="stylesheet" href="style.css"
</head>

<body>
  <div class="container">
    <h1>テスト分析ツールwebR</h1>

    <button id="templatedownloadBtn_exmk">テンプレートファイルのダウンロードはこちら(.xlsx)</button>
    <h2>ファイルのアップロード</h2>
    <p>分析対象のExcelファイルを選択してください。ファイルは外部に送信されません。</p>
    <input type="file" id="upload" accept=".xlsx">
    <button id="process-button">データの確認</button>

    <h2>加工後のデータ</h2>
    <div id="data-info" class="info"></div>
    <table id="data-table">
      <tbody>
        <!-- データ行はここに挿入されます -->
      </tbody>
    </table>

    <h2>分析コードの実行</h2>
    <p>webRを使って、ブラウザ上でRを実行します。使えるライブラリに制限があります。</p>
    <button class="sample-code-button" data-code="sample1">サンプルコード1</button>
    <button class="sample-code-button" data-code="sample2">サンプルコード2</button>
    <button class="sample-code-button" data-code="sample3">サンプルコード3</button>
    <button class="sample-code-button" data-code="sample4">サンプルコード4</button>
    <textarea id="r-code">
# デフォルトのRコード
webr::install("polycor")
webr::install("subscore")
library(ltm)
library(polycor)
library(subscore)
alpha <- cronbach.alpha(testdata)   #testdataにデータ行列が入っています。
tetra_corr_matrix <- hetcor(testdata)$correlations
eigen_values <- eigen(tetra_corr_matrix)$values
q3_result <- Yen.Q3(testdata, IRT.model="2pl")

# 結果の表示
output <- capture.output({
  cat("\nクロンバックのα:\n")
  print(alpha)
    cat("\n固有値（スクリープロット用）:\n")
    print(eigen_values)
    cat("\nYenのQ3統計量:\n")
    print(q3_result$Q3)
})

paste(output, collapse = "\n")
    </textarea>
    <button id="run-button">コードを実行</button>

    <h2>実行結果</h2>
    <button id="save-button">実行結果をテキストファイルとして保存</button>
    <div>
      <pre id="out">ここに結果が表示されます...</pre>
    </div>
  </div>

  <script type="module" src="script.js">  </script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</body>

</html>